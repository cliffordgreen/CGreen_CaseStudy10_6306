---
title: "Clifford Green Case Study 2"
output: html_document
---

#Introduction 

  For this Case Study we are going to look at the data provided by the Chulwalran government. The objective its to find the most appropriate model to forecast the exports for one of the selected plants. The plants that Chulwalra exports are Efak, Wuge, Blue Etel, and Red Etel. I chose to observed and predict the exports for Efak. The different types of forecasting models I will use to attempt to predict the Efak future exports are simple exponential smoothing, Holts exponential trend, and Holt-Winter seasonal method.

First we must load fpp  
```{r }
library(fpp)
```



### Importing Datasets

No we must import the datasets, using the read.csv function
```{r}
ImportedAsIsData <- read.csv(file="ImportedAsIsDataChulwalar.csv", header = F, sep=";", fill = T) #chose ImportedAsIsDataChulwalar.csv

ImportedPlanData <- read.csv("ImportedPlanDataChulwalar.csv", header = F, sep=";", fill = T) #chose ImportedPlanDataChulwalar.csv

ImportedIndicators <- read.csv("ImportedIndicatorsChulwalar.csv", header = F, sep=";", fill = T) # chose ImportedIndicatorsChulwalar.csv
```

### Cleaning the needed Data


Now we are extracting the necessary data from each file
```{r }

EfakAsIsVector <- c(ImportedAsIsData [16:27,2],ImportedAsIsData [16:27,3],ImportedAsIsData [16:27,4],ImportedAsIsData [16:27,5],ImportedAsIsData [16:27,6],ImportedAsIsData [16:27,7])

EfakPlanVector <- c(ImportedPlanData[16:27,2],ImportedPlanData[16:27,3],ImportedPlanData[16:27,4],ImportedPlanData[16:27,5],ImportedPlanData[16:27,6],ImportedPlanData[16:27,7])

EfakAsIs <- ts(EfakAsIsVector , start=c(2008,1), end=c(2013,12), frequency=12)

EfakPlan <- ts(EfakPlanVector, start=c(2008,1), end=c(2013,12), frequency=12)

```


```{r}
EfakAsIs_stl <- stl(EfakAsIs , s.window=5)
# Thus the individual time series can be shown graphically and tabularly.

# The trend of the total exports is almost linear. A relatively uniform 
# seaonality can be seen.

par(mfrow=c(3,2))

# It is interesting to note that the almost linear trend is not seen in the 
# individual segments. The individual trends run partially in opposite 
# directions in the middle of the time scale, which causes the linear trend 
# in the total As Is data.

plot(EfakAsIs_stl, col="black", main="EfakAsIs_stl")
EfakAsIs_stl
```




```{r}
cor(EfakAsIs , EfakPlan)
EfakAsIs_stl <- stl(EfakAsIs , s.window=5)
plot(EfakAsIs_stl, col="black", main="EfakAsIs_stl")
```


```{r}
monthplot(EfakAsIs_stl$time.series[,"seasonal"], main="", ylab="Seasonal")
```


```{r}
monthplot(EfakAsIs_stl$time.series[,"seasonal"], main="", ylab="Seasonal")
```



CEPI Correlation
```{r}
# Monthly Change in Export Price Index (CEPI)
CEPIVector <- c(ImportedIndicators[2:13,2],ImportedIndicators[2:13,3],ImportedIndicators[2:13,4],ImportedIndicators[2:13,5],ImportedIndicators[2:13,6],ImportedIndicators[2:13,7])
CEPI <- ts(CEPIVector , start=c(2008,1), end=c(2013,12), frequency=12)
plot(CEPI, main="CEPI")

cor(EfakAsIs , CEPI)
```

Temperature Correlation
```{r}
TemperatureVector <- c(ImportedIndicators[30:41,2],ImportedIndicators[30:41,3],ImportedIndicators[30:41,4],ImportedIndicators[30:41,5],ImportedIndicators[30:41,6],ImportedIndicators[30:41,7])
Temperature <- ts(TemperatureVector, start=c(2008,1), end=c(2013,12), frequency=12)
plot(Temperature, main="Temperature")

cor(EfakAsIs , Temperature)
```


Births In Chulwalar
```{r}
# Monthly births in Chulwalar 
BirthsVector <- c(ImportedIndicators[44:55,2],ImportedIndicators[44:55,3],ImportedIndicators[44:55,4],ImportedIndicators[44:55,5],ImportedIndicators[44:55,6],ImportedIndicators[44:55,7])
Births <- ts(BirthsVector, start=c(2008,1), end=c(2013,12), frequency=12)
plot(Births, main="Births")

cor(EfakAsIs , Births)
```


Mothly Satisfaction Index
```{r}
# Monthly Satisfaction Index (SI) external index 
SIExternVector <- c(ImportedIndicators[58:69,2],ImportedIndicators[58:69,3],ImportedIndicators[58:69,4],ImportedIndicators[58:69,5],ImportedIndicators[58:69,6],ImportedIndicators[58:69,7])
SIExtern <- ts(SIExternVector, start=c(2008,1), end=c(2013,12), frequency=12)
plot(SIExtern, main="SIExtern")

cor(EfakAsIs , SIExtern)
```


Yearly Exports from Urbano
```{r}
# Yearly exports from Urbano
UrbanoExportsVector <- c(ImportedIndicators[72:83,2],ImportedIndicators[72:83,3],ImportedIndicators[72:83,4],ImportedIndicators[72:83,5],ImportedIndicators[72:83,6],ImportedIndicators[72:83,7])
UrbanoExports <- ts(UrbanoExportsVector, start=c(2008,1), end=c(2013,12), frequency=12)
plot(UrbanoExports, main="UrbanoExports")

cor(EfakAsIs , UrbanoExports)
```


```{r}
# Yearly number of Globalisation Party members in Chulwalar
GlobalisationPartyMembersVector <- c(ImportedIndicators[86:97,2],ImportedIndicators[86:97,3],ImportedIndicators[86:97,4],ImportedIndicators[86:97,5],ImportedIndicators[86:97,6],ImportedIndicators[86:97,7])
GlobalisationPartyMembers <- ts(GlobalisationPartyMembersVector, start=c(2008,1), end=c(2013,12), frequency=12)
plot(GlobalisationPartyMembers, main="GlobalisationPartyMembers")

cor(EfakAsIs , GlobalisationPartyMembers)
```



```{r}
# Monthly Average Export Price Index for Chulwalar
AEPIVector <- c(ImportedIndicators[100:111,2],ImportedIndicators[100:111,3],ImportedIndicators[100:111,4],ImportedIndicators[100:111,5],ImportedIndicators[100:111,6],ImportedIndicators[100:111,7])
AEPI <- ts(AEPIVector, start=c(2008,1), end=c(2013,12), frequency=12)
plot(AEPI, main="AEPI")

cor(EfakAsIs , AEPI)
```


```{r}
# National Holidays
NationalHolidaysVector <- c(ImportedIndicators[170:181,2],ImportedIndicators[170:181,3],ImportedIndicators[170:181,4],ImportedIndicators[170:181,5],ImportedIndicators[170:181,6],ImportedIndicators[170:181,7])
NationalHolidays <- ts(NationalHolidaysVector, start=c(2008,1), end=c(2013,12), frequency=12)
plot(NationalHolidays, main="NationalHolidays")


cor(EfakAsIs , NationalHolidays)
```


```{r}
# Chulwalar Index (Total value of all companies in Chulwalar)
ChulwalarIndexVector <- c(ImportedIndicators[128:139,2],ImportedIndicators[128:139,3],ImportedIndicators[128:139,4],ImportedIndicators[128:139,5],ImportedIndicators[128:139,6],ImportedIndicators[128:139,7])
ChulwalarIndex <- ts(ChulwalarIndexVector, start=c(2008,1), end=c(2013,12), frequency=12)
plot(ChulwalarIndex, main="ChulwalarIndex")

cor(EfakAsIs , ChulwalarIndex)
```


```{r}
# Monthly Inflation rate in Chulwalar 
InflationVector <- c(ImportedIndicators[142:153,2],ImportedIndicators[142:153,3],ImportedIndicators[142:153,4],ImportedIndicators[142:153,5],ImportedIndicators[142:153,6],ImportedIndicators[142:153,7])
Inflation <- ts(InflationVector, start=c(2008,1), end=c(2013,12), frequency=12)
plot(Inflation, main="Inflation")

cor(EfakAsIs , Inflation)
```


```{r}
# Proposed spending for Independence day presents
IndependenceDayPresentsVector <- c(ImportedIndicators[156:167,2],ImportedIndicators[156:167,3],ImportedIndicators[156:167,4],ImportedIndicators[156:167,5],ImportedIndicators[156:167,6],ImportedIndicators[156:167,7])
IndependenceDayPresents <- ts(IndependenceDayPresentsVector, start=c(2008,1), end=c(2013,12), frequency=12)
plot(IndependenceDayPresents, main="IndependenceDayPresents")

cor(EfakAsIs , IndependenceDayPresents)
```


```{r}
# Influence of National Holidays :
# This indicator is an experiment where the influence of National Holidays is 
# extended into the months leading up to the holiday. 
# However later tests show that this indicator is no better for forecasting than the
# orignial National Holidays indicator.    
InfluenceNationalHolidaysVector <- c(ImportedIndicators[184:195,2],ImportedIndicators[184:195,3],ImportedIndicators[184:195,4],ImportedIndicators[184:195,5],ImportedIndicators[184:195,6],ImportedIndicators[184:195,7])
InfluenceNationalHolidays <- ts(InfluenceNationalHolidaysVector, start=c(2008,1), end=c(2013,12), frequency=12)
plot(InfluenceNationalHolidays, main="InfluenceNationalHolidays")


cor(EfakAsIs , InfluenceNationalHolidays)
```


```{r}
# The months April and December do not correlate well with the exports data. 
# However later tests will show that these are worth considering. 
# The missing correlation is just due to the sparse structure of the NationalHolidays time series.

# Chulwalar Index (Total value of all companies in Chulwalar)
ChulwalarIndexVector <- c(ImportedIndicators[128:139,2],ImportedIndicators[128:139,3],ImportedIndicators[128:139,4],ImportedIndicators[128:139,5],ImportedIndicators[128:139,6],ImportedIndicators[128:139,7])
ChulwalarIndex <- ts(ChulwalarIndexVector, start=c(2008,1), end=c(2013,12), frequency=12)
plot(ChulwalarIndex, main="ChulwalarIndex")

cor(EfakAsIs , ChulwalarIndex)
```


```{r}
# Monthly Inflation rate in Chulwalar 
InflationVector <- c(ImportedIndicators[142:153,2],ImportedIndicators[142:153,3],ImportedIndicators[142:153,4],ImportedIndicators[142:153,5],ImportedIndicators[142:153,6],ImportedIndicators[142:153,7])
Inflation <- ts(InflationVector, start=c(2008,1), end=c(2013,12), frequency=12)
plot(Inflation, main="Inflation")


cor(EfakAsIs , Inflation)
```


```{r}
# Proposed spending for Independence day presents
IndependenceDayPresentsVector <- c(ImportedIndicators[156:167,2],ImportedIndicators[156:167,3],ImportedIndicators[156:167,4],ImportedIndicators[156:167,5],ImportedIndicators[156:167,6],ImportedIndicators[156:167,7])
IndependenceDayPresents <- ts(IndependenceDayPresentsVector, start=c(2008,1), end=c(2013,12), frequency=12)
plot(IndependenceDayPresents, main="IndependenceDayPresents")

cor(EfakAsIs , IndependenceDayPresents)
```


```{r}
# Influence of National Holidays :
# This indicator is an experiment where the influence of National Holidays is 
# extended into the months leading up to the holiday. 
# However later tests show that this indicator is no better for forecasting than the
# orignial National Holidays indicator.    
InfluenceNationalHolidaysVector <- c(ImportedIndicators[184:195,2],ImportedIndicators[184:195,3],ImportedIndicators[184:195,4],ImportedIndicators[184:195,5],ImportedIndicators[184:195,6],ImportedIndicators[184:195,7])
InfluenceNationalHolidays <- ts(InfluenceNationalHolidaysVector, start=c(2008,1), end=c(2013,12), frequency=12)
plot(InfluenceNationalHolidays, main="InfluenceNationalHolidays")

cor(EfakAsIs , InfluenceNationalHolidays)
```

```{r}
SIExternOffsetByOneMonthVector <- c(ImportedIndicators[57:68,2],ImportedIndicators[57:68,3],ImportedIndicators[57:68,4],ImportedIndicators[57:68,5],ImportedIndicators[57:68,6],ImportedIndicators[57:68,7])
SIExternOffsetByOneMonth <- ts(SIGovVector, start=c(2008,1), end=c(2013,11), frequency=12)
plot(SIExternOffsetByOneMonth, main="SIExternOffsetByOneMonth")

EfakAsIsWithoutDec12013 <- ts(EfakAsIsVector , start=c(2008,1), end=c(2013,11), frequency=12)

cor(EfakAsIsWithoutDec12013, SIExternOffsetByOneMonth)
```

```{r}
SIGovVectorShifted2Months <- c(ImportedIndicators[15:26,2],ImportedIndicators[15:26,3],ImportedIndicators[15:26,4],ImportedIndicators[15:26,5],ImportedIndicators[15:26,6],ImportedIndicators[15:26,7])
SIGovShifted2Months <- ts(SIGovVectorShifted2Months , start=c(2008,1), end=c(2013,10), frequency=12)
plot(SIGovShifted2Months)

EfakAsIsWithoutNovDec2013 <- ts(EfakAsIsVector , start=c(2008,1), end=c(2013,10), frequency=12)

cor(EfakAsIsWithoutNovDec2013, SIGovShifted2Months)
```




and creating a time series from the data


# Predictive modelling 
Now we are using the various provided models to find the an accurate prediction forecast for the Efak data.To find a better model we are going to compare AIC, AICc, BIC, and the Error Measures. AIC is the measure of relative quality of statistical models. For this analysis, the lower the AIC means the model minimizes information loss, and therefor may fit the data better. AICc is AIC but it corrects for finite sample sizes. RMSE shows the absolute fit of the model to the data. Since it is the square root of the variance of the residuals, it is an absolute measure of fit.

##Base Model-Simple Exponential Smooth 

Not a very sophisticated model, it is essentially assuming that the model will increase exponentially with no trend or seasonal accommodation. Seeing as how there some seasonal trend in the Efak data, this model will obviously not be the most accomidating. We will use this model as the base fit and try to find a model that fits better. 
```{r}
Model_ses <- ses(EfakAsIs, h=12)
plot(Model_ses)
# 
#    AIC     AICc      BIC 
#1977.827 1978.001 1982.380 
# 
# Error measures:
#                    ME     RMSE      MAE      MPE     MAPE      MASE       ACF1
# Training set 28255.57 105746.4 83785.28 1.618532 12.24071 0.5987073 -0.1644141
# The Akaike's Information Criterion(AIC/AICc) or the Bayesian Information 
# Criterion (BIC) should be at minimum.


plot(Model_ses, plot.conf=FALSE, ylab="Exports Chulwalar  )", xlab="Year", main="", fcol="white", type="o")
lines(fitted(Model_ses), col="green", type="o")
lines(Model_ses$mean, col="blue", type="o")
legend("topleft",lty=1, col=c(1,"green"), c("data", expression(alpha == 0.671)),pch=1)

```

###Holts Linear Trend Model
Holts linear Trend Model is An extension of the base model for simple exponential smoothing. Holts linear model enables forecasting that incorporates trends. The four different types of Holts Linear Trend models that we can test are, Linear Trend, Exponential trend, Exponential Damped and Additive Damped Trend. The predicted model is not longer flat because of the estimated trend in each instance.  
```{r}

Model_holt_1 <- holt(EfakAsIs,h=12)
plot(Model_holt_1)
#this model assumes a linear model
# The trend is exponential if the intercepts(level) and the gradient (slope) are
# multiplied with eachother. The values are worse. As the Beta was very low in 
# the optimisation, the forecast is very similar to the ses() model. 
#    AIC     AICc      BIC 
#1975.610 1976.207 1984.717  
# 
# Error measures:
#                    ME     RMSE      MAE      MPE     MAPE      MASE       ACF1
# Training set 12981.24 101278.2 78180.91 -0.3405668 11.62379 0.5586599 -0.03795009
```

Looking at the first holt linear trend model, we can see that the AIC, AICc, BIC, and RSME are all lower than the base simple exponential smoothing. From this we can say that this model fits the trend better than the previous.



###Holts Exponential Trend
```{r}

Model_holt_2<- holt(EfakAsIs, exponential=TRUE,h=12)
plot(Model_holt_2)
#this model test an exponential model
# As such simple trends tend to forecast the future to positively, we have added
# a dampener.
# Similar values to that of Model_holt_1 
#    AIC     AICc      BIC 
#1975.029 1975.626 1984.136 
# 
# Error measures:
#                    ME     RMSE      MAE      MPE     MAPE      MASE       ACF1
# Training set 1027.787 99625.5 76933.69 -2.069541 11.56529 0.5497476 -0.0136902

```

The above model, instead of assuming linearity, it assumes the trend is exponential, when comparing the AIC, AICc, BIC, and RSME, we can see that all the values are again lower, so this model fits the data better than the holts linear.


###Holts Addittive Damped Trend
```{r}
Model_holt_3 <- holt(EfakAsIs, damped=TRUE,h=12)
plot(Model_holt_3)

# This also works for exponential trends. 
# The values remain worse. 
#    AIC     AICc      BIC 
#1979.044 1979.953 1990.427 
# 
# Error measures:
#                    ME     RMSE      MAE      MPE     MAPE      MASE       ACF1
# Training set 15606.58 102291.5 78689.55 0.03374579 11.66226 0.5622945 -0.03419302
```

The next model we tested was holts damped, which works with the exponential model. Unfortunately, when comparing the AIC, AICc, BIC, and RSME, the values are worse than just the Holts exponential model. 

###Holts Exponential Damped
```{r}
Model_holt_4 <- holt(EfakAsIs, exponential=TRUE, damped=TRUE,h=12)
plot(Model_holt_4)
#    AIC     AICc      BIC 
#1978.710 1979.619 1990.093 
# 
# Error measures:
#                    ME     RMSE      MAE      MPE     MAPE      MASE       ACF1
# Training set 3135.947 101334.4 77773.93 -2.424052 11.85843 0.5557518 -0.07442583

# level and slope can be plotted individually for each model. 
```

Next we tried the Holts exponential + damped, when comparing the AIC, AICc, BIC, and RSME, the values did improve, but they are still lower than just the Holts exponential model. So far the best model fit is the Holts exponential model.


###All Holts Models plotted together
```{r}
plot(Model_holt_1, plot.conf=FALSE, ylab="Exports Chulwalar  )", xlab="Year", main="", fcol="white", type="o")
lines(fitted(Model_ses), col="purple", type="o")
lines(fitted(Model_holt_1), col="blue", type="o")
lines(fitted(Model_holt_2), col="red", type="o")
lines(fitted(Model_holt_3), col="green", type="o")
lines(fitted(Model_holt_4), col="orange", type="o")
lines(Model_ses$mean, col="purple", type="o")
lines(Model_holt_1$mean, col="blue", type="o")
lines(Model_holt_2$mean, col="red", type="o")
lines(Model_holt_3$mean, col="green", type="o")
lines(Model_holt_4$mean, col="orange", type="o")
legend("topleft",lty=1, col=c(1,"purple","blue","red","green","orange"), c("data", "SES","Holts auto", "Exponential", "Additive Damped", "Multiplicative Damped"),pch=1)

```

Above is a plot of the as is data comparted to the predictive models


##Holt-Winter's seasonal method  
"Holt and Winters have expanded Holt's model further to include the
seasonality aspect. The parameter gamma, which is for smoothing the
seasonality, was added to achieve this. The values are better than 
the models without seasonality. This logically matches our results from the regression approaches,the data is strongly influenced by seasonality. 
In the following model, none of the parameters are given so that they
will be optimised automatically. There are two models: one using
an additive error model method and one using a multiplicative error model."

###Holts Seasonal-additive  
```{r}
Model_hw_1 <- hw(EfakAsIs ,seasonal="additive",h=12)
plot(Model_hw_1)
#    AIC     AICc      BIC 
#1958.925 1968.816 1995.352 
# 
# Error measures:
#                    ME     RMSE      MAE      MPE     MAPE      MASE       ACF1
# Training set 8710.859 76350.81 61147.93 -0.2519017 8.973478 0.4369468 -0.09126643
```

Here we test the Holts Seasonal Additive model, this model accommodates seasonal changes. When we compare the AIC, AICc, BIC, and RSME to the Holts exponential model, we can see significant decreases in all of the values. It is clear that this model fits the data much better than the previously observed models. 

###Holts Seasonal-multiplicative
```{r}
Model_hw_2 <- hw(EfakAsIs ,seasonal="multiplicative",h=12)
plot(Model_hw_2)
#    AIC     AICc      BIC 
#1964.418 1974.309 2000.844  
# 
# Error measures:
#                    ME     RMSE      MAE      MPE     MAPE      MASE       ACF1
# Training set 6211.726 83390.08 64171.99 -0.6174998 9.086466 0.458556 -0.1381724
# The additive model gives slightly better results than the multiplicative model.
```

Here we test the Holts Seasonal Multiplicative model. When we compare the AIC, AICc, BIC, and RSME to the Holts seasonal additive model, we can see some of the values have increase slightly. The AIC, AICc, BIC and RSME are all higher but the ME is lower. Although the ME is lower, the Holts Seasonal Additive Model still fits the data better than the Multiplicative model.


###All Holts seasonal plotted together
```{r}
plot(Model_hw_1, ylab="Exports Chulwalar  ", plot.conf=FALSE, type="o", fcol="white", xlab="Year")
lines(fitted(Model_hw_1), col="red", lty=2)
lines(fitted(Model_hw_2), col="green", lty=2)
lines(Model_hw_1$mean, type="o", col="red")
lines(Model_hw_2$mean, type="o", col="green")
legend("topleft",lty=1, pch=1, col=1:3, c("data","Holt Winters' Additive","Holt Winters' Multiplicative"))
```

Above is a plot of the two Holts Seasonal Models


#Conclution

  If we had to give to presentation to the Chulwalar government and give an accurate model and prediction for the Efak exports based off of the information we were provided. I would suggest using a the Holts Season Additive Model for the prediction model. When comparing the AIC and RMSE values, the Holts Seasonal Additive Model fits the data much better than other models observed. I think we can confidently say that best fitting model is the Holts Seasonal Additive Model based on the summary statistics. 

